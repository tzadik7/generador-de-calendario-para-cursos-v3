<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Calendarios Médicos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1a73e8;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .form-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: bold;
            color: #202124;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .input-group input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 10px rgba(26, 115, 232, 0.2);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: #1a73e8;
            color: white;
        }

        .btn-primary:hover {
            background: #1557b0;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            background: #34a853;
            color: white;
        }

        .btn-secondary:hover {
            background: #2d8f47;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 168, 83, 0.3);
        }

        .btn-success {
            background: #fbbc04;
            color: #333;
        }

        .btn-success:hover {
            background: #f9ab00;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(251, 188, 4, 0.3);
        }

        .view-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 10px 20px;
            border: 2px solid #1a73e8;
            border-radius: 25px;
            background: white;
            color: #1a73e8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .view-btn.active {
            background: #1a73e8;
            color: white;
        }

        .view-btn:hover {
            background: #1a73e8;
            color: white;
        }

        .calendar-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .calendar-section.active {
            display: block;
        }

        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .calendar-header h2 {
            color: #1a73e8;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .calendar-info {
            background: #e8f0fe;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #1a73e8;
        }

        .week-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-badge {
            background: #1a73e8;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .calendar-table th {
            background: linear-gradient(135deg, #1a73e8, #4285f4);
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
            font-weight: 600;
        }

        .calendar-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: top;
        }

        .calendar-table tr:hover {
            background: #f8f9fa;
        }

        .date-cell {
            width: 200px;
            font-weight: bold;
            background: #f8f9fa;
            color: #202124;
        }

        .activity-cell {
            position: relative;
        }

        /* Colores por módulo */
        .mod-1 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #333; }
        .mod-2 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .mod-3 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; }
        .mod-4 { background: linear-gradient(135deg, #ff8a80 0%, #ff80ab 100%); color: white; }
        .mod-5 { background: linear-gradient(135deg, #81c784 0%, #aed581 100%); color: white; }
        .mod-6 { background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%); color: white; }
        .mod-7 { background: linear-gradient(135deg, #ba68c8 0%, #ab47bc 100%); color: white; }
        .mod-8 { background: linear-gradient(135deg, #ffb74d 0%, #ffa726 100%); color: white; }
        .mod-9 { background: linear-gradient(135deg, #4db6ac 0%, #26a69a 100%); color: white; }
        .mod-10 { background: linear-gradient(135deg, #f06292 0%, #ec407a 100%); color: white; }
        .intervention { background: linear-gradient(135deg, #ff7043 0%, #ff5722 100%); color: white; font-weight: bold; }
        .workshop { background: linear-gradient(135deg, #5c6bc0 0%, #3f51b5 100%); color: white; font-weight: bold; }
        .evaluation { background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%); color: white; font-weight: bold; }
        .practice { background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%); color: white; font-weight: bold; }
        .induction { background: linear-gradient(135deg, #ab47bc 0%, #9c27b0 100%); color: white; font-weight: bold; }
        .graduation { background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%); color: #333; font-weight: bold; text-align: center; font-size: 1.1em; }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-success {
            background: #e6f4ea;
            color: #137333;
            border-left: 4px solid #34a853;
        }

        .alert-error {
            background: #fce8e6;
            color: #d93025;
            border-left: 4px solid #ea4335;
        }

        .alert-warning {
            background: #fef7e0;
            color: #f9ab00;
            border-left: 4px solid #fbbc04;
        }

        .week-view {
            display: none;
        }

        .week-container {
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .week-header {
            background: linear-gradient(135deg, #34a853, #4caf50);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 500;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            background: #e0e0e0;
        }

        .day-cell {
            background: white;
            padding: 15px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
        }

        .day-header {
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .day-activity {
            font-size: 0.85em;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group, .view-controls {
                flex-direction: column;
            }
            
            .week-grid {
                grid-template-columns: 1fr;
            }
            
            .date-cell {
                width: 150px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>🎓 Generador de Calendarios Médicos</h1>
            <p>Sistema Profesional de Gestión de Cursos</p>
        </div>

        <!-- FORMULARIO -->
        <div class="form-section">
            <h2 style="color: #1a73e8; margin-bottom: 25px;">📝 Crear Nuevo Curso</h2>
            
            <div class="form-grid">
                <div class="input-group">
                    <label for="courseName">Nombre del Curso:</label>
                    <input type="text" id="courseName" placeholder="Ej: Curso de Ultrasonido 2025">
                </div>
                <div class="input-group">
                    <label for="startDate">Fecha de Inicio:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="input-group">
                    <label for="instructor">Instructor:</label>
                    <input type="text" id="instructor" placeholder="Nombre del instructor">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateCalendar()">
                    📅 Generar Calendario
                </button>
                <button class="btn btn-secondary" onclick="saveCalendar()">
                    💾 Guardar Calendario
                </button>
                <button class="btn btn-success" onclick="printCalendar()">
                    🖨️ Imprimir
                </button>
            </div>

            <div id="alerts"></div>
        </div>

        <!-- CALENDARIO -->
        <div class="calendar-section" id="calendarSection">
            <div class="calendar-header">
                <h2 id="calendarTitle">📅 Calendario Generado</h2>
                <div class="calendar-info" id="calendarInfo"></div>
                <div class="week-info" id="weekInfo"></div>
            </div>

            <!-- CONTROLES DE VISTA -->
            <div class="view-controls">
                <button class="view-btn active" onclick="switchView('day', this)">📅 Vista por Días</button>
                <button class="view-btn" onclick="switchView('week', this)">📊 Vista por Semanas</button>
            </div>

            <!-- VISTA POR DÍAS -->
            <div id="dayView">
                <div id="calendarContent"></div>
            </div>

            <!-- VISTA POR SEMANAS -->
            <div id="weekView" class="week-view">
                <div id="weekContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Estructura del curso
        const courseStructure = [
            ...Array(8).fill().map((_, i) => `Módulo 1. Introducción D${i + 1}`),
            ...Array(11).fill().map((_, i) => `Módulo 2. Renal D${i + 1}`),
            '1ra Intervención Entrenamiento Continuo',
            ...Array(14).fill().map((_, i) => `Módulo 3. Genitourinario D${i + 1}`),
            '2da Intervención Entrenamiento Continuo',
            ...Array(23).fill().map((_, i) => `Módulo 4. Mama D${i + 1}`),
            ...Array(20).fill().map((_, i) => `Módulo 5. Abdomen D${i + 1}`),
            '3ra Intervención Entrenamiento Continuo',
            ...Array(25).fill().map((_, i) => `Módulo 6. Obstetricia D${i + 1}`),
            '4ta Intervención Entrenamiento Continuo',
            'Taller botoneria',
            ...Array(7).fill().map((_, i) => `Módulo 7. Tejidos blandos D${i + 1}`),
            'Taller de cierre mama D1',
            'Taller de cierre mama D2',
            ...Array(11).fill().map((_, i) => `Módulo 8. Cabeza y cuello D${i + 1}`),
            '5ta Intervención Entrenamiento Continuo',
            'Curso ACLS',
            ...Array(5).fill().map((_, i) => `Módulo 9. Correlación clinica D${i + 1}`),
            ...Array(2).fill().map((_, i) => `Módulo 10. Multimodal D${i + 1}`),
            'Evaluación final Entrenamiento Continuo D1',
            'Evaluación final Entrenamiento Continuo D2',
            ...Array(10).fill().map((_, i) => `Practicas finales D${i + 1}`),
            'Inducción D1',
            'Inducción D2',
            'Inducción D3',
            'Graduación'
        ];

        // Eventos que no pueden solaparse
        const nonOverlapEvents = [
            'Intervención Entrenamiento Continuo',
            'Taller de cierre mama',
            'Curso ACLS',
            'Taller botoneria',
            'Inducción',
            'Graduación'
        ];

        let currentCalendar = null;
        let currentView = 'day';

        // Función principal para generar calendario
        function generateCalendar() {
            console.log('Generando calendario...'); // Para debug
            
            const courseName = document.getElementById('courseName').value;
            const startDate = document.getElementById('startDate').value;
            const instructor = document.getElementById('instructor').value;

            if (!courseName || !startDate) {
                showAlert('Por favor completa el nombre del curso y la fecha de inicio.', 'error');
                return;
            }

            try {
                const schedule = createSchedule(new Date(startDate));
                
                currentCalendar = {
                    name: courseName,
                    startDate: startDate,
                    instructor: instructor || 'No especificado',
                    schedule: schedule
                };

                displayCalendar();
                showAlert('✅ ¡Calendario generado exitosamente!', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showAlert('❌ Error al generar el calendario: ' + error.message, 'error');
            }
        }

        // Crear horario con restricciones
        function createSchedule(startDate) {
            let schedule = [];
            let currentDate = new Date(startDate);
            let moduleIndex = 0;

            while (moduleIndex < courseStructure.length) {
                if (currentDate.getDay() >= 1 && currentDate.getDay() <= 5) {
                    const weekOfDiplomado = Math.floor(moduleIndex / 5) + 1;
                    const weekOfYear = getWeekOfYear(currentDate);
                    
                    schedule.push({
                        date: new Date(currentDate),
                        activity: courseStructure[moduleIndex],
                        dayOfWeek: currentDate.getDay(),
                        weekOfDiplomado: weekOfDiplomado,
                        weekOfYear: weekOfYear
                    });
                    moduleIndex++;
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return applyConstraints(schedule);
        }

        // Aplicar restricciones
        function applyConstraints(schedule) {
            const adjusted = [...schedule];
            
            // Encontrar eventos especiales
            for (let i = 0; i < adjusted.length; i++) {
                const item = adjusted[i];
                
                // Intervenciones a viernes
                if (item.activity.includes('Intervención Entrenamiento Continuo')) {
                    const fridayDate = findNextFriday(item.date);
                    adjusted[i].date = fridayDate;
                    adjusted[i].dayOfWeek = 5;
                }
                
                // Inducción a lunes-martes-miércoles
                if (item.activity.includes('Inducción D1')) {
                    const mondayDate = findNextMonday(item.date);
                    adjusted[i].date = mondayDate;
                    adjusted[i].dayOfWeek = 1;
                } else if (item.activity.includes('Inducción D2')) {
                    const mondayDate = findNextMonday(item.date);
                    const tuesdayDate = new Date(mondayDate);
                    tuesdayDate.setDate(mondayDate.getDate() + 1);
                    adjusted[i].date = tuesdayDate;
                    adjusted[i].dayOfWeek = 2;
                } else if (item.activity.includes('Inducción D3')) {
                    const mondayDate = findNextMonday(item.date);
                    const wednesdayDate = new Date(mondayDate);
                    wednesdayDate.setDate(mondayDate.getDate() + 2);
                    adjusted[i].date = wednesdayDate;
                    adjusted[i].dayOfWeek = 3;
                }
                
                // Graduación a jueves
                if (item.activity.includes('Graduación')) {
                    const inductionWednesday = adjusted.find(x => x.activity.includes('Inducción D3'));
                    if (inductionWednesday) {
                        const thursdayDate = new Date(inductionWednesday.date);
                        thursdayDate.setDate(inductionWednesday.date.getDate() + 1);
                        adjusted[i].date = thursdayDate;
                        adjusted[i].dayOfWeek = 4;
                    }
                }
            }

            // Ordenar por fecha
            return adjusted.sort((a, b) => a.date - b.date);
        }

        // Encontrar próximo viernes
        function findNextFriday(date) {
            const result = new Date(date);
            const daysUntilFriday = (5 - result.getDay() + 7) % 7;
            if (daysUntilFriday === 0 && result.getDay() !== 5) {
                result.setDate(result.getDate() + 7);
            } else {
                result.setDate(result.getDate() + daysUntilFriday);
            }
            return result;
        }

        // Encontrar próximo lunes
        function findNextMonday(date) {
            const result = new Date(date);
            const daysUntilMonday = (1 - result.getDay() + 7) % 7;
            if (daysUntilMonday === 0 && result.getDay() !== 1) {
                result.setDate(result.getDate() + 7);
            } else {
                result.setDate(result.getDate() + daysUntilMonday);
            }
            return result;
        }

        // Obtener semana del año
        function getWeekOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 1);
            const days = Math.floor((date - start) / (24 * 60 * 60 * 1000));
            return Math.ceil((days + start.getDay() + 1) / 7);
        }

        // Mostrar calendario
        function displayCalendar() {
            const section = document.getElementById('calendarSection');
            const title = document.getElementById('calendarTitle');
            const info = document.getElementById('calendarInfo');
            const weekInfo = document.getElementById('weekInfo');

            title.textContent = `📅 ${currentCalendar.name}`;
            
            const startDate = currentCalendar.schedule[0].date;
            const endDate = currentCalendar.schedule[currentCalendar.schedule.length - 1].date;
            const totalWeeks = Math.ceil(currentCalendar.schedule.length / 5);

            info.innerHTML = `
                <strong>Instructor:</strong> ${currentCalendar.instructor}<br>
                <strong>Inicio:</strong> ${formatDate(startDate)}<br>
                <strong>Fin:</strong> ${formatDate(endDate)}<br>
                <strong>Duración:</strong> ${currentCalendar.schedule.length} días hábiles (${totalWeeks} semanas)<br><br>
                <strong>📌 Restricciones Aplicadas:</strong><br>
                🎯 Intervenciones siempre en viernes<br>
                🚀 Inducción en lunes-martes-miércoles consecutivos<br>
                🎓 Graduación en jueves
            `;

            const firstWeekDiplomado = currentCalendar.schedule[0].weekOfDiplomado;
            const firstWeekYear = currentCalendar.schedule[0].weekOfYear;

            weekInfo.innerHTML = `
                <div class="week-badge">Semana ${firstWeekDiplomado} del Diplomado</div>
                <div class="week-badge">Semana ${firstWeekYear} del Año</div>
            `;

            renderCurrentView();
            section.classList.add('active');
        }

        // Cambiar vista
        function switchView(viewType, button) {
            currentView = viewType;
            
            // Actualizar botones
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Mostrar/ocultar vistas
            document.getElementById('dayView').style.display = viewType === 'day' ? 'block' : 'none';
            document.getElementById('weekView').style.display = viewType === 'week' ? 'block' : 'none';
            
            renderCurrentView();
        }

        // Renderizar vista actual
        function renderCurrentView() {
            if (!currentCalendar) return;
            
            if (currentView === 'day') {
                renderDayView();
            } else if (currentView === 'week') {
                renderWeekView();
            }
        }

        // Renderizar vista por días
        function renderDayView() {
            const container = document.getElementById('calendarContent');
            const monthGroups = groupByMonth(currentCalendar.schedule);
            
            container.innerHTML = '';
            
            monthGroups.forEach(month => {
                const monthDiv = createMonthTable(month);
                container.appendChild(monthDiv);
            });
        }

        // Renderizar vista por semanas
        function renderWeekView() {
            const container = document.getElementById('weekContent');
            const weekGroups = groupByWeek(currentCalendar.schedule);
            
            container.innerHTML = '';
            
            weekGroups.forEach(week => {
                const weekDiv = createWeekContainer(week);
                container.appendChild(weekDiv);
            });
        }

        // Agrupar por mes
        function groupByMonth(schedule) {
            const groups = {};
            
            schedule.forEach(day => {
                const key = `${day.date.getFullYear()}-${day.date.getMonth()}`;
                if (!groups[key]) {
                    groups[key] = {
                        year: day.date.getFullYear(),
                        month: day.date.getMonth(),
                        days: []
                    };
                }
                groups[key].days.push(day);
            });

            return Object.values(groups);
        }

        // Agrupar por semana
        function groupByWeek(schedule) {
            const groups = {};
            
            schedule.forEach(day => {
                const key = day.weekOfDiplomado;
                if (!groups[key]) {
                    groups[key] = {
                        weekNumber: day.weekOfDiplomado,
                        yearWeek: day.weekOfYear,
                        days: []
                    };
                }
                groups[key].days.push(day);
            });

            return Object.values(groups);
        }

        // Crear tabla de mes
        function createMonthTable(month) {
            const monthNames = ['ENERO', 'FEBRERO', 'MARZO', 'ABRIL', 'MAYO', 'JUNIO',
                               'JULIO', 'AGOSTO', 'SEPTIEMBRE', 'OCTUBRE', 'NOVIEMBRE', 'DICIEMBRE'];

            const container = document.createElement('div');
            container.style.marginBottom = '30px';

            const table = document.createElement('table');
            table.className = 'calendar-table';

            // Header de la tabla
            const headerRow = document.createElement('tr');
            const monthHeader = document.createElement('th');
            monthHeader.colSpan = 2;
            monthHeader.textContent = `${monthNames[month.month]} ${month.year}`;
            headerRow.appendChild(monthHeader);
            table.appendChild(headerRow);

            // Filas de datos
            month.days.forEach(day => {
                const row = document.createElement('tr');
                
                const dateCell = document.createElement('td');
                dateCell.className = 'date-cell';
                dateCell.innerHTML = `
                    ${formatFullDate(day.date)}<br>
                    <small style="font-size: 0.8em; color: #666;">
                        Sem. ${day.weekOfDiplomado} Dip. | Sem. ${day.weekOfYear} Año
                    </small>
                `;
                
                const activityCell = document.createElement('td');
                activityCell.className = `activity-cell ${getActivityClass(day.activity)}`;
                
                let activityText = day.activity;
                if (day.activity.includes('Intervención Entrenamiento Continuo')) {
                    activityText = `🎯 ${day.activity} (VIERNES)`;
                } else if (day.activity.includes('Inducción')) {
                    const dayNames = ['', 'LUNES', 'MARTES', 'MIÉRCOLES'];
                    activityText = `🚀 ${day.activity} (${dayNames[day.dayOfWeek]})`;
                } else if (day.activity.includes('Graduación')) {
                    activityText = `🎓 ${day.activity} (JUEVES)`;
                } else if (day.activity.includes('Taller')) {
                    activityText = `🔧 ${day.activity}`;
                } else if (day.activity.includes('ACLS')) {
                    activityText = `🚑 ${day.activity}`;
                }
